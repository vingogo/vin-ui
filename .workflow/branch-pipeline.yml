version: '1.0'
name: branch-pipeline
displayName: BranchPipeline
triggers:
  trigger: auto
  push:
    branches:
      precise:
        - main
stages:
  - name: compile
    displayName: ç¼–è¯‘
    strategy: naturally
    trigger: auto
    steps:
      - step: build@nodejs
        name: build_nodejs
        displayName: Nodejs æ„å»º
        nodeVersion: 14.16.0
        commands:
          - npm install -g pnpm@8.6.1
          - pnpm install
          - ''
          - if [ -d "docs/.vuepress/dist" ]; then
          - '  rm -rf docs/.vuepress/dist'
          - fi
          - ''
          - echo 'ğŸš€ å¼€å§‹æ„å»º...'
          - ''
          - 'npm run build:docs # > /dev/null 2>&1'
          - ''
          - if [ $? -ne 0 ]; then
          - '    echo "âŒ æ„å»ºå¤±è´¥ã€‚è¯·ä½¿ç”¨ npm run build:docs å‘½ä»¤æ„å»ºä»¥æŸ¥çœ‹è¯¦æƒ…"'
          - '    exit'
          - fi
          - ''
          - echo 'ğŸ‰ æ„å»ºæˆåŠŸ!'
          - ''
          - echo 'å¼€å§‹å°†ç”Ÿæˆçš„é™æ€ç½‘ç«™æ¨é€è‡³ gt-pages åˆ†æ”¯'
          - ''
          - cd docs/.vuepress/dist && git init  && git checkout --orphan gt-pages  \
          - '&& git add .  && git commit -m "pushed by deploy.sh"  \'
          - '&& git remote add origin git@gitee.com:vingogo/vin-ui.git  \'
          - '&& git push origin gt-pages --force  && rm -rf .git'
          - ''
          - if [ $? -ne 0 ]; then
          - '    echo "âŒ æŠ±æ­‰ï¼Œæ¨é€å¤±è´¥äº†"'
          - '    exit'
          - fi
          - ''
          - echo 'ğŸ‰ æ¨é€æˆåŠŸ!'
        artifacts:
          - name: BUILD_ARTIFACT
            path:
              - ./docs/.vuepress/dist
        caches: []
        strategy: {}
